# Backend для приложения

Для увеличения отзывчивости я выбрал работать
с [API HN](https://github.com/HackerNews/API), вместо парсинга rss. Это
упростит доступ к данным, а также позволит более точечно обновлять данные. Также я
буду использовать fastapi для интеграции асинхронности.

## Обзор функционала

Все приложение будет состоять из 2 основных компонентов: loader и task_manager. **task_manager** -
набор инструментов для работы с API и прочими долгими процессами, а **server** - 
RESTFUL API, предоставляющий доступ к системе. Весь backend будет работать как кэш 
для API HN и перенаправлять запросы только в случае, если не хватает данных.

## task_manager

Этот компонент должен содержать основные абстракции для работы с API HN. Основные задачи:

- периодически загружать новые публикации 
- загружать информацию о публикации
- загружать полные ветки комментариев

Эти инструменты будут использоваться при помощи Celery и Celery Beat (+ Redis), чтобы 
не блокировать основной API. Этот стэк позволит как динамически вызывать функции для 
получения самых свежих данных, так и выполнять некоторые задачи на фоне. 

Архитектура модуля:
``` 
/task_manager
    /hn_client.py  # async requests from hn api
    /tasks.py      # celery tasks
    /scheduler.py  # celery beat config
    /utils.py      # db acess
```

В дальнейшем можно добавить сюда задачи, связанные с машинным обучением. 

## serving

Это gateway для всех задач которые будет делать этот backend. Основные задачи:

- список публикаций
  - последних
  - в тренде
  - рекомендации
  - фильтры
  - текстовый поиск
  - пагинация
- полная информация о публикации и комментариях
- социальные функции
  - лайки
  - подписки

Дизайн API
``` 
/api/v1
    /feed
        /new 
            [GET] - получить последние публикации
        /trending 
            [GET] - получить публикации в тренде
        /recomended 
            [GET] - получить рекомендованые публикации
        /search 
            [POST] - полнотекстовый поиск
            ---
            параметры для всех выше:
                ?page_size=int
                ?order_by=[dt_published, n_comments, rating]
                ?sort_order=[desc, asc]
                
        /story/<id: int> 
            [GET] - получить полную информацию о публикации по id
            /comments
                [GET] - получить список всех комментариев под публикацией
            /like
                [GET] - статус лайка на публикации
                [POST] - инвертировать статус лайка на публикации
    /uers
        /id
            /subscribe     
```