# Отчет по лабораторной работе №3

**Тема:** Упаковка FastAPI-приложения в Docker, работа с источниками данных и очереди  
**Цель:** Научиться упаковывать FastAPI-приложение, интегрировать парсер с БД и вызывать
его через API и очередь

---

## Ход работы:

### **1. Упаковка приложения, БД и парсера в Docker**

* Реализован `Dockerfile` для FastAPI-приложения.
* Приложение использует Python 3.13 и зависимости из `requirements.txt`.
* Добавлен `docker-compose.yml`, включающий:
    * PostgreSQL как БД,
    * Redis как брокер очередей,
    * FastAPI backend,
    * Celery worker и Celery beat.
* Все сервисы объединены в единую сеть и запускаются одной командой `docker-compose up`.

### **2. Вызов парсера из FastAPI**

* Реализован эндпоинт `/lab2/threading` и `/lab2/multiprocessing`, которые вызывают парсер
  с использованием `threading` и `multiprocessing`.
* Для взаимодействия с базой данных используется SQLModel и асинхронные сессии SQLAlchemy.
* Эндпоинт `/api/v1/topstories` и другие маршруты предоставляют API-доступ к данным.

### **3. Вызов парсера через очередь Celery**

* Настроена очередь задач с использованием Celery и Redis.
* Создана задача `fetch_story_comments`, исполняемая Celery worker.
* Эндпоинты `/celery/start_task/{story_id}`, `/celery/task_status/{task_id}` и
  `/celery/wait_for_task/{story_id}` реализуют:

    * постановку задачи в очередь,
    * проверку статуса выполнения,
    * синхронное ожидание результата.
* Также настроен `celery_beat` для запуска периодических задач.

---

## Используемые технологии:

* **FastAPI** — основной веб-фреймворк.
* **PostgreSQL** — база данных, развернута в контейнере.
* **Docker + Docker Compose** — контейнеризация и оркестрация сервисов.
* **Celery + Redis** — асинхронная обработка задач.
* **Threading / Multiprocessing** — реализация парсера с различными подходами к
  параллелизму.

---

## Вывод:

В ходе лабораторной работы удалось:

* Упаковать и развернуть сложную систему с несколькими микросервисами.
* Интегрировать парсер с API и базой данных.
* Настроить асинхронную очередь задач с Celery.
  Полученные навыки являются важным шагом в освоении DevOps и MLOps практик.
